{"version":3,"sources":["uni-app:///main.js","webpack:///E:/github-me/np-book/uniapp-cloud/pages/bookshelf/bookshelf.vue?6568","webpack:///E:/github-me/np-book/uniapp-cloud/pages/bookshelf/bookshelf.vue?a40e","webpack:///E:/github-me/np-book/uniapp-cloud/pages/bookshelf/bookshelf.vue?44d5","webpack:///E:/github-me/np-book/uniapp-cloud/pages/bookshelf/bookshelf.vue?f410","uni-app:///pages/bookshelf/bookshelf.vue","webpack:///E:/github-me/np-book/uniapp-cloud/pages/bookshelf/bookshelf.vue?f918","webpack:///E:/github-me/np-book/uniapp-cloud/pages/bookshelf/bookshelf.vue?41d7"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page"],"mappings":"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","file":"pages/bookshelf/bookshelf.js","sourcesContent":["import 'uni-pages';\n// @ts-ignore\nwx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;import '@dcloudio/vue-cli-plugin-uni/packages/uni-cloud/dist/index.js';\nimport Vue from 'vue'\nimport Page from './pages/bookshelf/bookshelf.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./bookshelf.vue?vue&type=template&id=59858e6c&\"\nvar renderjs\nimport script from \"./bookshelf.vue?vue&type=script&lang=js&\"\nexport * from \"./bookshelf.vue?vue&type=script&lang=js&\"\nimport style0 from \"./bookshelf.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\runtime\\\\componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/bookshelf/bookshelf.vue\"\nexport default component.exports","export * from \"-!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\templateLoader.js??vue-loader-options!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--16-0!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\template.js!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-uni-app-loader\\\\page-meta.js!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./bookshelf.vue?vue&type=template&id=59858e6c&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  if (!_vm._isMounted) {\n    _vm.e0 = function($event) {\n      _vm.showShareMenu = true\n    }\n  }\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--12-1!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./bookshelf.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--12-1!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./bookshelf.vue?vue&type=script&lang=js&\"","<template>\r\n\t<pubpage :title=\"shelfInfo.name\">\r\n\t\t<view slot=\"contentSection\" style=\"position: relative;\">\r\n\t\t\t<canvas v-show=\"isCanvas\" id=\"myPoster\" canvas-id=\"myPoster\" type=\"2d\"></canvas>\r\n\t\t\t<pubshare v-if=\"showShareMenu\" @selected=\"onShareSelected\" @dismiss=\"onShareDismiss\"></pubshare>\r\n\r\n\t\t\t<view class=\"User_info\">\r\n\t\t\t\t<view @click=\"openPage(shelfInfo.ownerinfo._id)\" style=\"display: flex;position: relative;\">\r\n\t\t\t\t\t<view class=\"User_avatarUrl\">\r\n\t\t\t\t\t\t<image :src=\"shelfInfo.ownerinfo.avatarUrl\"></image>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view class=\"User_text\">\r\n\t\t\t\t\t\t<text class=\"nickName\">{{shelfInfo.ownerinfo.nickName}}</text>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\r\n\t\t\t\t<view v-if=\"isExi\">\r\n\t\t\t\t\t<pubfolow ref=\"pubfolow\" :user_id=\"shelfInfo.ownerinfo._id\"></pubfolow>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"np-address\">\r\n\t\t\t\t<text>{{shelfInfo.address}}</text>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"textTitle\">\r\n\t\t\t\t<text>{{shelfInfo.textTitle}}</text>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"desc\">\r\n\t\t\t\t<text>{{shelfInfo.desc}}</text>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"time\">\r\n\t\t\t\t<text>{{shelfInfo.createtime}}</text>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"np-divider\"></view>\r\n\r\n\t\t\t<view style=\"justify-content: start;display: flex;flex-wrap: wrap;padding-bottom: 70px;position: relative;\">\r\n\t\t\t\t<view v-if=\"books\" style=\"width: 100%;display: flex;flex-wrap: wrap;\">\r\n\t\t\t\t\t<view v-for=\"item in books\" :key=\"item._id\"\r\n\t\t\t\t\t\tstyle=\"width: 33.3%;float: left;padding:10px;margin-bottom: 10px;\">\r\n\t\t\t\t\t\t<bookcell :data=\"item\"></bookcell>\r\n\t\t\t\t\t\t<view v-if=\"isEditing\" @click=\"btnDeleteBook\" :data-id=\"item._id\"\r\n\t\t\t\t\t\t\tstyle='font-size:10px;text-align:center;margin-top: 10px;'><text\r\n\t\t\t\t\t\t\t\tstyle=\"padding:5px 10px;background:#f3433e;color:#fff;border-radius:5px;\">编辑</text>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\r\n\t\t\t\t<view v-if=\"isBooksLen\" ref=\"BooksLen\"\r\n\t\t\t\t\tstyle=\"position: absolute;width: 100%;text-align: center;top: 25%;\">暂无图书</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t<!-- 管理员底部编辑 -->\r\n\t\t<view v-if=\"shelfInfo.isowner\" slot=\"tabSection\" style=\"padding:10px;\">\r\n\t\t\t<view v-if=\"!isEditing\"\r\n\t\t\t\tstyle=\"background-color: #00aaff;width: 100%;height: 50px;border-radius: 25px;display: flex;line-height: 50px;color:#fff;justify-content: space-between;\">\r\n\t\t\t\t<view @click=\"showShareMenu= true\" class=\"iconfont icon-share\"\r\n\t\t\t\t\tstyle=\"width:50px;height: 50px;text-align: center;\"></view>\r\n\t\t\t\t<view @click=\"btnScan\" style=\"flex:1;text-align: center;\">添加图书</view>\r\n\t\t\t\t<view @click=\"btnEnterEditing\" class=\"iconfont icon-apps\"\r\n\t\t\t\t\tstyle=\"width:50px;height: 50px;text-align: center;\"></view>\r\n\t\t\t</view>\r\n\t\t\t<view v-else\r\n\t\t\t\tstyle=\"background-color: #00aaff;width: 100%;height: 50px;border-radius: 25px;display: flex;line-height: 50px;color:#fff;justify-content: space-between;\">\r\n\t\t\t\t<view></view>\r\n\t\t\t\t<view @click=\"btnExitEditing\" style=\"flex:1;text-align: center;\">退出编辑模式</view>\r\n\t\t\t\t<view></view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t\r\n\t\t<!-- 公共底部 -->\r\n\t\t<view slot=\"footerSection\">\r\n\t\t\t<pubfooter \r\n\t\t\t:shelfid=\"shelfid\"\r\n\t\t\t:heart=\"shelfInfo.heart\"\r\n\t\t\t:star=\"shelfInfo.star\"\r\n\t\t\t:isheart=\"shelfInfo.isheart\"\r\n\t\t\t:isstar=\"shelfInfo.isstar\"\r\n\t\t\t:totalheart=\"shelfInfo.totalheart\"\r\n\t\t\t:totalstar=\"shelfInfo.totalstar\"\r\n\t\t\t></pubfooter>\r\n\t\t</view>\r\n\t</pubpage>\r\n</template>\r\n\r\n<script>\r\n\timport cloudApi from \"../../common/cloudApi.js\"\r\n\timport timeApi from \"../../common/timeApi.js\"\r\n\timport pubpage from \"../../components/pubpage.vue\"\r\n\timport pubshare from \"../../components/pubshare.vue\"\r\n\timport pubfooter from \"../../components/pubfooter.vue\"\r\n\timport pubfolow from \"../../components/pubfolow.vue\"\r\n\t\r\n\timport bookcell from \"../../components/pub-ui/bookcell.vue\"\r\n\timport {\r\n\t\tmapState,\r\n\t\tmapGetters,\r\n\t\tmapMutations,\r\n\t\tmapActions\r\n\t} from 'vuex'\r\n\r\n\texport default {\r\n\t\tcomponents: {\r\n\t\t\tpubpage,\r\n\t\t\tbookcell,\r\n\t\t\tpubshare,\r\n\t\t\tpubfooter,\r\n\t\t\tpubfolow\r\n\t\t},\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\ttitle: \"\",\r\n\t\t\t\tisEditing: false,\r\n\t\t\t\tshelfInfo: null,\r\n\t\t\t\tshelfid: null,\r\n\t\t\t\tcanloadmore: true,\r\n\t\t\t\tshowShareMenu: false,\r\n\t\t\t\tisBooksLen: false,\r\n\t\t\t\tisCanvas: false,\r\n\t\t\t\tbooks: [],\r\n\t\t\t\tisExi:false,\r\n\t\t\t\t\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\twatch: {\r\n\t\t\tbooks(cur) {\r\n\t\t\t\tcur < 1 ? this.isBooksLen = true : this.isBooksLen = false;\r\n\t\t\t},\r\n\t\t\t'shelfInfo.isowner': {\r\n\t\t\t\thandler: function(cur) {\r\n\t\t\t\t\t// console.log('权限',cur)\r\n\t\t\t\t\tcur ? this.isExi = false : this.isExi = true;\t\t\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t},\r\n\t\tonLoad(options) {\r\n\t\t\tthis.shelfid = options.id;\r\n\t\t\t// console.log(options.id)\r\n\t\t\tif (!this.shelfid) uni.navigateBack();\r\n\r\n\t\t\tthis.getShelfInfo();\r\n\t\t\tthis.requestBookList();\r\n\t\t},\r\n\t\t// onReachBottom() {\r\n\t\t// \tthis.requestBookList(this.books[this.books.length - 1]._id);\r\n\t\t// },\r\n\t\tonShareAppMessage() {\r\n\t\t\treturn {\r\n\t\t\t\ttitle: this.title,\r\n\t\t\t\tpath: '/pages/me/index?scene=sid=' + this.shelfInfo._id\r\n\t\t\t}\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\t// 进入客态页\r\n\t\t\topenPage(id){\r\n\t\t\t\t// console.log(id,this.isowner)\r\n\t\t\t\tif(!this.shelfInfo.isowner){\r\n\t\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\t\turl:\"../../orderpage/index/index?id=\"+id\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\r\n\t\t\t},\r\n\t\t\t// 生成海报\r\n\t\t\tdrawPoster() {\r\n\t\t\t\tthis.isCanvas = true;\r\n\t\t\t\tuni.showLoading({\r\n\t\t\t\t\ttitle: \"生成中\",\r\n\t\t\t\t\tmask: true\r\n\t\t\t\t});\r\n\t\t\t\tconst query = wx.createSelectorQuery()\r\n\t\t\t\tconsole.log(query.select('#myPoster'))\r\n\t\t\t\tquery.select('#myPoster')\r\n\t\t\t\t\t.fields({\r\n\t\t\t\t\t\tnode: true,\r\n\t\t\t\t\t\tsize: true\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.exec(async (res) => {\r\n\t\t\t\t\t\tvar canvas = res[0].node\r\n\t\t\t\t\t\tvar ctx = canvas.getContext('2d')\r\n\r\n\t\t\t\t\t\tconst dpr = uni.getSystemInfoSync().pixelRatio\r\n\t\t\t\t\t\tcanvas.width = res[0].width * dpr\r\n\t\t\t\t\t\tcanvas.height = res[0].height * dpr\r\n\t\t\t\t\t\tctx.scale(dpr, dpr)\r\n\r\n\t\t\t\t\t\tctx.fillStyle = \"#ffffff\";\r\n\t\t\t\t\t\tctx.fillRect(0, 30, 350, 750);\r\n\r\n\t\t\t\t\t\t//ownerInfo\r\n\t\t\t\t\t\tctx.fillStyle = 'black';\r\n\t\t\t\t\t\tctx.fontSize = 20;\r\n\t\t\t\t\t\t// console.log(this.shelfInfo.name)\r\n\t\t\t\t\t\tctx.fillText(\"用户名：\" + this.shelfInfo.ownerinfo.nickName, 70, 50);\r\n\r\n\t\t\t\t\t\tctx.fontSize = 20\r\n\t\t\t\t\t\tctx.fillText(\"书房名：\" + this.shelfInfo.name, 70, 65);\r\n\r\n\t\t\t\t\t\tctx.fontSize = 20\r\n\t\t\t\t\t\tctx.fillText(\"地址：\" + this.shelfInfo.address, 70, 80);\r\n\r\n\t\t\t\t\t\tvar image = canvas.createImage();\r\n\t\t\t\t\t\timage.onload = (res) => {\r\n\t\t\t\t\t\t\tctx.drawImage(image, 10, 35, 50, 50);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\timage.src = this.shelfInfo.ownerinfo.avatarUrl;\r\n\r\n\r\n\t\t\t\t\t\t//books\r\n\t\t\t\t\t\tvar bookLength = Math.min(this.books.length, 9);\r\n\t\t\t\t\t\tvar bookIndex = 0;\r\n\t\t\t\t\t\tvar loadNextBookCover = () => {\r\n\t\t\t\t\t\t\tvar bookItem = this.books[bookIndex];\r\n\t\t\t\t\t\t\t// console.log(this.books)\r\n\t\t\t\t\t\t\tif (this.books.length < 1) {\r\n\t\t\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\t\t\tcontent: '无图书分享',\r\n\t\t\t\t\t\t\t\t\tshowCancel: false\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\treturn\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tuni.getImageInfo({\r\n\t\t\t\t\t\t\t\tsrc: bookItem.cover_url,\r\n\t\t\t\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\t\t\t\tvar image = canvas.createImage();\r\n\r\n\t\t\t\t\t\t\t\t\timage.onload = () => {\r\n\t\t\t\t\t\t\t\t\t\tvar dx = Math.floor(bookIndex % 3) * (100 + 15) + 10;\r\n\t\t\t\t\t\t\t\t\t\tvar dy = Math.floor(bookIndex / 3) * (150 + 15) + 100;\r\n\t\t\t\t\t\t\t\t\t\tctx.drawImage(image, dx, dy, 100, 150);\r\n\t\t\t\t\t\t\t\t\t\t// 书名\r\n\t\t\t\t\t\t\t\t\t\tctx.fontSize = 16\r\n\t\t\t\t\t\t\t\t\t\tctx.fillText(bookItem.title, dx, dy + 165, 100);\r\n\r\n\t\t\t\t\t\t\t\t\t\tif (bookIndex < bookLength - 1) {\r\n\t\t\t\t\t\t\t\t\t\t\tbookIndex++;\r\n\t\t\t\t\t\t\t\t\t\t\tloadNextBookCover();\r\n\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\tconsole.log(\"全部封面加载结束\");\r\n\t\t\t\t\t\t\t\t\t\t\tuni.hideLoading();\r\n\r\n\t\t\t\t\t\t\t\t\t\t\tuni.canvasToTempFilePath({\r\n\t\t\t\t\t\t\t\t\t\t\t\tcanvas: canvas,\r\n\t\t\t\t\t\t\t\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tuni.previewImage({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcurrent: res\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.tempFilePath,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\turls: [res\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.tempFilePath\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t]\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t\t\tfail: (err) => {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tconsole.log(err);\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t })\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\timage.src = res.path;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t//wxacode\r\n\t\t\t\t\t\tconst wxacodeRes = await cloudApi.call({\r\n\t\t\t\t\t\t\tname: \"getwxacode\",\r\n\t\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\t\tscene: \"sid=\" + this.shelfInfo._id\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tconsole.log(wxacodeRes)\r\n\r\n\t\t\t\t\t\t// 本地缓存文件\r\n\t\t\t\t\t\tconst fs = wx.getFileSystemManager()\r\n\t\t\t\t\t\tconst wr = fs.writeFileSync(\r\n\t\t\t\t\t\t\t`${wx.env.USER_DATA_PATH}/mpcode.jpg`,\r\n\t\t\t\t\t\t\tuni.arrayBufferToBase64(wxacodeRes.result.data),\r\n\t\t\t\t\t\t\t\"base64\"\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t\tuni.getImageInfo({\r\n\t\t\t\t\t\t\tsrc: `${wx.env.USER_DATA_PATH}/mpcode.jpg`,\r\n\t\t\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\t\t\tconsole.log('二维码', res)\r\n\t\t\t\t\t\t\t\tvar image = canvas.createImage();\r\n\t\t\t\t\t\t\t\timage.onload = (res) => {\r\n\t\t\t\t\t\t\t\t\tctx.drawImage(image, 350 - 170, 750 - 170, 160, 160);\r\n\t\t\t\t\t\t\t\t\tloadNextBookCover();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\timage.src = res.path;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\r\n\r\n\r\n\t\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t// 底部分享\r\n\t\t\tonShareSelected(index) {\r\n\t\t\t\tconsole.log('分享点击',index)\r\n\t\t\t\tif (index == 1) {\r\n\t\t\t\t\tthis.drawPoster();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tonShareDismiss() {\r\n\t\t\t\tconsole.log('取消')\r\n\t\t\t\tthis.showShareMenu = false;\r\n\t\t\t},\r\n\t\t\t// 请求当前书房信息\r\n\t\t\tgetShelfInfo() {\r\n\t\t\t\tcloudApi.call({\r\n\t\t\t\t\tname: \"bookshelfs\",\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\taction: \"get\",\r\n\t\t\t\t\t\t_id: this.shelfid\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\tconsole.log(res.result);\r\n\t\t\t\t\t\tthis.shelfInfo = res.result;\r\n\t\t\t\t\t\tthis.shelfInfo.createtime ?\r\n\t\t\t\t\t\tthis.shelfInfo.createtime = timeApi.timestampToTime(this.shelfInfo.createtime) :\r\n\t\t\t\t\t\tthis.shelfInfo.createtime = '';\r\n\t\t\t\t\t\t// console.log('时间戳',this.shelfInfo.createtime)\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t// 请求书籍列表\r\n\t\t\trequestBookList(start = 0) {\r\n\t\t\t\tif (start && !this.canloadmore) return;\r\n\t\t\t\tcloudApi.call({\r\n\t\t\t\t\tname: \"books\",\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\taction: \"listbyshelf\",\r\n\t\t\t\t\t\tshelfid: this.shelfid,\r\n\t\t\t\t\t\tstart: start\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\tthis.canloadmore = res.result.length >= 9;\r\n\t\t\t\t\t\tif (!start) this.books = res.result;\r\n\t\t\t\t\t\telse this.books = this.books.concat(res.result);\r\n\r\n\t\t\t\t\t\t// console.log('图书',this.books)\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tbtnDeleteBook(e) {\r\n\t\t\t\tconsole.log(e.currentTarget.dataset.id);\r\n\t\t\t\tuni.showActionSheet({\r\n\t\t\t\t\titemList: [\"置顶\", \"删除\"],\r\n\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\tif (res.tapIndex == 0) {\r\n\t\t\t\t\t\t\tcloudApi.call({\r\n\t\t\t\t\t\t\t\tname: \"books\",\r\n\t\t\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\t\t\taction: \"movetop\",\r\n\t\t\t\t\t\t\t\t\tbookid: e.currentTarget.dataset.id\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\t\t\t\tthis.requestBookList();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t} else if (res.tapIndex == 1) {\r\n\t\t\t\t\t\t\tcloudApi.call({\r\n\t\t\t\t\t\t\t\tname: \"books\",\r\n\t\t\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\t\t\taction: \"delete\",\r\n\t\t\t\t\t\t\t\t\tshelfid: this.shelfid,\r\n\t\t\t\t\t\t\t\t\tbookid: e.currentTarget.dataset.id\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\t\t\t\tthis.requestBookList();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tbtnExitEditing() {\r\n\t\t\t\tthis.isEditing = false;\r\n\t\t\t},\r\n\t\t\tbtnEnterEditing() {\r\n\t\t\t\tthis.isEditing = true;\r\n\t\t\t},\r\n\r\n\t\t\t// 扫码添加图书\r\n\t\t\tbtnScan() {\r\n\t\t\t\tuni.showModal({\r\n\t\t\t\t\tcontent: \"请您通过书籍后面的条形码进行扫码添加书籍哦\",\r\n\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\tif (res.confirm) {\r\n\t\t\t\t\t\t\tuni.scanCode({\r\n\t\t\t\t\t\t\t\tsuccess: async (res) => {\r\n\t\t\t\t\t\t\t\t\tconsole.log('扫码结果', res)\r\n\t\t\t\t\t\t\t\t\tconst isbnres = await cloudApi.call({\r\n\t\t\t\t\t\t\t\t\t\tname: \"ISBNQuery\",\r\n\t\t\t\t\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\t\t\t\t\tisbn: res.result,\r\n\t\t\t\t\t\t\t\t\t\t\tshelfid: this.shelfid,\r\n\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\tsuccess: async (res) => {\r\n\t\t\t\t\t\t\t\t\t\t\tconsole.log('doubanbook', res)\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t// 检查数据库是否已存在\r\n\t\t\t\t\t\t\t\t\t\t\tif (res.result.state) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tawait cloudApi.call({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tname: \"books\",\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\taction: \"add\",\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tshelfid: this.shelfid,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tisbnid: res.result.resData._id,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tcontent: res.result.msg,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tshowCancel: false\r\n\t\t\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\tthis.requestBookList();\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tfail: (err) => {\r\n\t\t\t\t\t\t\t\t\tconsole.log('扫码失败', err);\r\n\t\t\t\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\t\t\t\tcontent: '扫码失败,请重新尝试',\r\n\t\t\t\t\t\t\t\t\t\tshowCancel: false\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t})\r\n\t\t\t\t\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n\tpage {\r\n\t\tbackground-color: #fff;\r\n\t}\r\n\r\n\t#myPoster {\r\n\t\tposition: absolute;\r\n\t\tdisplay: block;\r\n\t\tleft: -350px;\r\n\t\twidth: 350px;\r\n\t\theight: 750px;\r\n\t\t// width: 98%;\r\n\t\t// height: 99%;\r\n\t\t// left: 50%;\r\n\t\t// top: 50%;\r\n\t\t// transform: translate(-50%,-50%);\r\n\t}\r\n\r\n\t.User_info {\r\n\t\twidth: auto;\r\n\t\tmargin: 30rpx 0;\r\n\t\tpadding-left: 30rpx;\r\n\t\tposition: relative;\r\n\r\n\t\t.User_avatarUrl {\r\n\t\t\twidth: 150rpx;\r\n\t\t\theight: 150rpx;\r\n\t\t\tborder-radius: 50%;\r\n\r\n\t\t\timage {\r\n\t\t\t\twidth: 100%;\r\n\t\t\t\theight: 100%;\r\n\t\t\t\tborder-radius: 50%;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t.User_text {\r\n\t\t\tdisplay: flex;\r\n\t\t\talign-items: center;\r\n\t\t\tmargin-left: 20rpx;\r\n\r\n\t\t\t.nickName {\r\n\t\t\t\tmargin: 10rpx 0;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\n\t}\r\n\r\n\t.textTitle {\r\n\t\tpadding: 0 20rpx;\r\n\t\tfont-size: 40rpx;\r\n\t\tdisplay: block;\r\n\t\tmargin: 20rpx 0;\r\n\t}\r\n\r\n\t.desc {\r\n\t\tpadding: 0 20rpx;\r\n\t\tfont-size: 35rpx;\r\n\t\tdisplay: block;\r\n\t\tmargin: 20rpx 0;\r\n\t}\r\n\r\n\t.time {\r\n\t\tpadding: 0 20rpx;\r\n\t\tfont-size: 22rpx;\r\n\t\tdisplay: block;\r\n\t\tmargin: 20rpx 0;\r\n\t\tcolor: #666;\r\n\t\ttext-align: right;\r\n\t}\r\n\r\n</style>\r\n","import mod from \"-!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--8-oneOf-1-0!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-1!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-2!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--8-oneOf-1-3!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\sass-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-4!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-5!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./bookshelf.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--8-oneOf-1-0!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-1!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-2!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--8-oneOf-1-3!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\sass-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-4!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-5!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./bookshelf.vue?vue&type=style&index=0&lang=scss&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1659887293807\n      var cssReload = require(\"D:/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"../../\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}